---
title: "Programming for Data Science 3"
author: "yuchihchia"
date: "2020年5月21日"
output: 
  html_document:
    toc: true
    toc_depth: 3
    toc_float:
      collapsed: false
      smooth_scroll: TRUE
---
<font face="Taipei Sans TC Beta Light">  
```{r echo=FALSE}
library(stringr)
library(purrr)
```
# 第5章 Programming  
## 5.1 Pipe  
### 5.1.1 原則  
<font color="#0b5395">**範例一**：找出身高最高的人。</font>  
```{r}
threeHeigths <- c(Gary=178, John=182, Cam=175)
# 先排序由大到小
sort(threeHeigths, decreasing=T) -> sorted_heights
# 把排好的人名取出
names(sorted_heights) -> sorted_persons
# 接著取出第一個位置的人名
sorted_persons[[1]] -> highestPerson
print(highestPerson)
```
**Pipe 原則**：  

* 把`->`中間物件 換成`%>%`。  
* 再把其他有用到中間物件的位置換成`.`。  

原本：
```{r eval=FALSE}
f(w) -> x
g(x) -> y
h(y) -> z
```
可寫成：
```{r eval=FALSE}
f(w) %>%
  g(.) %>% 
  h(.) -> z
```
或
```{r eval=FALSE}
w %>%
  f(.) %>%
  g(.) %>%
  h(.) -> z
```
<font color="#0b5395">再回到**範例一**</font>  
```{r}
library(magrittr)
sort(threeHeigths, decreasing=T) %>% 
  names(.) %>%
  .[[1]] -> highestPerson
print(highestPerson)
```
<font color="#0b5395">**範例二**：由 cities 創出每個元素對應的北部、東部、中部 region factor。</font>  
```{r}
cities <- factor(c("台北","花蓮","台東","台中"))
levels(cities)
region <- cities
# pipe operation
levels(region) %>% 
  str_replace(.,"台北","北部") %>%
  str_replace(.,"花蓮|台東","東部") %>%
  str_replace(.,"台中","中部") -> levels(region)
levels(region)
```
### 5.1.2 元素粹取  
```{r}
num <- c(2,97,22,15,7)
# 選出大於50的數字
(num > 50) %>%
  num[.]
```
### 5.1.3 執行順序  
面對 pipe 時會先把 pipe 走完最後才去做值 assign 給最後物件的動作。  
```{r}
threeHeigths %>%
  sort(., decreasing=T) %>%
  names(.) %>%
  .[[1]] -> highestPerson
```
### 5.1.4 `.`省略原則  
若代表中間物件的`.`在函數的「**第一位**」則`.`**可省略不寫**，連它後面的`,`也去掉。小心若不在**第一位**則不可做省略`.`動作。  
```{r}
levels(region) %>% 
  str_replace("台北","北部") %>%
  str_replace("花蓮|台東","東部") %>%
  str_replace("台中","中部") -> levels(region)
```
要小心`%>%`是將左邊output放到右邊函數，這裡的右邊函數指的是最外圍的函數：  
```{r error=TRUE}
population <- c(`cityA`=500,`cityB`=1500, `cityC`=399)
cities <- c("cityA","cityA","cityB","cityB","cityC")
# 錯誤示範
population %>% 
  names(sort(.)) %>%
  factor(cities, levels=.) -> cities
```
`%>%`是把population放到names()的input裡，而非sort()，但names()的input位置已被sort佔走。  
```{r}
# 正確示範
population %>%
  sort() %>%
  names() %>%
factor(cities, levels=.) -> cities
```
### 5.1.5 串接非單純函數程序
若遇到pipe 串接的下一段並不是單純的**函數**的話，可以用`{}`把此段內容括起來並把前一段output要放的位置換成`.`。  

<font color="#0b5395">**範例三**：找出 dataList 中元素 class 為 numeric 裡那些大於 50 的數字。</font> 
```{r}
dataList <- list(
  num=c(2,97,22,15,7),
  chr=c("2","97","22","15","7")
)
```






















</font>